<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: rpi, | MUGEN C-400]]></title>
  <link href="http://www.embodiedweb.net/blog/blog/categories/rpi-/atom.xml" rel="self"/>
  <link href="http://www.embodiedweb.net/blog/"/>
  <updated>2014-01-05T00:29:33+09:00</updated>
  <id>http://www.embodiedweb.net/blog/</id>
  <author>
    <name><![CDATA[Hideyuki Takei]]></name>
    <email><![CDATA[takehide22@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[RaspberryPi(debian)にL-02Cを繋いでPPP接続を行う＆PPP再接続を自動にする方法]]></title>
    <link href="http://www.embodiedweb.net/blog/blog/2012/12/31/connect-ppp-on-raspberrypi-debina/"/>
    <updated>2012-12-31T09:29:00+09:00</updated>
    <id>http://www.embodiedweb.net/blog/blog/2012/12/31/connect-ppp-on-raspberrypi-debina</id>
    <content type="html"><![CDATA[<h2>今年、僕たちは植木を作る。</h2>

<p><a href="https://github.com/hideyuki/ueki">https://github.com/hideyuki/ueki</a></p>

<p><img src="https://raw.github.com/hideyuki/ueki/master/images/ueki.png" alt="image" /></p>

<p>植木型のソーシャル植物ロボット。</p>

<p>盆栽が動くんだ。わくわくする。</p>

<p>ということで、さっそくその準備だ。RaspberryPiを使っているが、debianが動いているし使い方も全く変わらない。</p>

<h2>L-02Cをdebianで使うには</h2>

<p>L-02Cは、最初CDドライブとして認識され、それをアンマウントするとシリアルポートとして認識される。</p>

<p>lsusb で確認してみよう。L-02Cを挿しときはこんな感じで認識される。</p>

<p><code>
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 001 Device 002: ID 0424:9512 Standard Microsystems Corp.
Bus 001 Device 003: ID 0424:ec00 Standard Microsystems Corp.
Bus 001 Device 004: ID 05e3:0608 Genesys Logic, Inc. USB-2.0 4-Port HUB
Bus 001 Device 005: ID 2019:ab2a PLANEX GW-USNano2 802.11n Wireless Adapter [Realtek RTL8188CUS]
Bus 001 Device 006: ID 1004:618f LG Electronics, Inc.
</code></p>

<p>一番下の LG Electronics, Inc がL-02C。</p>

<p>ejectしてみよう。</p>

<p><code>
$ eject sr0
</code></p>

<p>そして、もう一度 lsusb でチェック。</p>

<p><code>
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 001 Device 002: ID 0424:9512 Standard Microsystems Corp.
Bus 001 Device 003: ID 0424:ec00 Standard Microsystems Corp.
Bus 001 Device 004: ID 05e3:0608 Genesys Logic, Inc. USB-2.0 4-Port HUB
Bus 001 Device 005: ID 2019:ab2a PLANEX GW-USNano2 802.11n Wireless Adapter [Realtek RTL8188CUS]
Bus 001 Device 006: ID 1004:618f LG Electronics, Inc. Ally/Optimus One
</code></p>

<p>Ally/Optimus One なんてのがついてる。それとともに /dev/ttyUSB0〜3が出現する。これがUSBモデムのシリアルポートです。</p>

<p>最初のCDドライブとして認識されるのは邪魔なので、usb_modeswitchを使って最初からシリアルポートとして認識されるようにしてみよう。</p>

<p>まずはusb_modeswitchのインストールから。</p>

<p><code>
$ sudo apt-get install usb_modeswitch
</code></p>

<p>そして、/etc/usb_modeswitch.confを編集</p>

<p>``` bash /etc/usb_moduswitch.conf https://github.com/hideyuki/ueki/blob/master/conf/usb_modeswitch.conf Source
DefaultVendor= 0x1004
DefaultProduct=0x61dd</p>

<p>TargetVendor= 0x1004
TargetProduct=0x618f</p>

<p>MessageContent=5553424312345678000000000000061b000000020000000000000000000000
NeedResponse=1
CheckSuccess=20
```</p>

<p>これでOK。</p>

<p>最後にL-02CがUSBポートに挿されたらusb_modeswitchが動くようにルールを設定する。</p>

<p><code>bash /etc/udev/rules/80-L02C.rules https://github.com/hideyuki/ueki/blob/master/conf/80-L02C.rules Source
SUBSYSTEM=="usb",ACTION=="add",ATTRS{idVendor}=="1004",ATTRS{idProduct}=="61dd", RUN+="usb_modeswitch '%b/%k'"
</code></p>

<p>挿したら、いきなり/dev/ttyUSB0〜3が出てくるようになるはずだ。</p>

<p>参考：</p>

<p><a href="http://www.draisberghof.de/usb_modeswitch/bb/viewtopic.php?t=783">http://www.draisberghof.de/usb_modeswitch/bb/viewtopic.php?t=783</a></p>

<h2>wvdialでPPP接続を簡単にする</h2>

<p>では、/dev/ttyUSB2を使ってPPP接続してみよう。</p>

<p>参考になるページはこちら↓</p>

<p><a href="http://qapla.blog52.fc2.com/blog-entry-313.html">http://qapla.blog52.fc2.com/blog-entry-313.html</a></p>

<p>書かれているとおりにするとうまくいきます。</p>

<h2>wvdialで 自動的にPPP再接続できるようにする</h2>

<p>上記ページで最初の接続はうまくいくが、再接続すると、接続を確立できない。</p>

<p><a href="http://www.nttdocomo.co.jp/binary/pdf/support/trouble/manual/download/l02c/L-02C_J_08.pdf">L-02CのATコマンド</a>をチェックしてみると「ATH」で明示的に回線を切断できるようだ。</p>

<p>で結局、Initに1度ATH、2度ほど AT&amp;F ATZ コマンドを行ったら再接続がうまくいくようになりました。</p>

<p>AT&amp;F、ATZ コマンド共にL-02CのATコマンド設定値を工場出荷時の設定値に戻します。</p>

<p>```bash /etc/wvdial.conf https://github.com/hideyuki/ueki/blob/master/conf/wvdial.conf Source
[Dialer Defaults]
Init1 = ATH
Init2 = AT&amp;F
Init3 = ATZ
Init4 = AT&amp;F
Init5 = ATZ
Init6 = ATQ0 V1 E1 S0=0 &amp;C1 &amp;D2 +FCLASS=0
Init7 = AT+CGDCONT=1,"IP","iijmio.jp"
Dial Attempts = 3
Stupid Mode = 1
Modem Type = Analog Modem
Dial Command = ATD
Stupid Mode = on
Baud = 460800
New PPPD = yes
APN = iijmio.jp</p>

<h1>APN = ynmbl.net</h1>

<p>Modem = /dev/ttyUSB2
ISDN = 0
Phone = <em>99</em>**1#
Password = iij
Username = mio@iij
Carrier Check = off
Check Def Route = on
Abort on No Dialtone = off
```</p>

<p>めでたし、めでたし。</p>
]]></content>
  </entry>
  
</feed>
